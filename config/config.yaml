system:
  name: "Shiyi"
  log_level: "DEBUG"
  audio_sample_rate: 16000

# é€šé“é…ç½®
channels:
  voice:
    enabled: true   # è¯­éŸ³é€šé“

  cli:
    enabled: true   # CLI æ–‡å­—é€šé“
    default_session: true

  api:
    enabled: false  # FastAPI HTTP é€šé“
    host: "0.0.0.0"
    port: 8000
    cors_origins: ["*"]

# TUI ç»ˆç«¯ç•Œé¢é…ç½®
tui:
  nerd_font: false  # è®¾ä¸º true éœ€å…ˆå®‰è£… Nerd Fontï¼Œè§ fonts/README.md

wake_word:
  engine: "openwakeword"
  model_path: null
  threshold: 0.5
  skip_wake_word: true  # è·³è¿‡å”¤é†’è¯ï¼Œç›´æ¥ç›‘å¬ï¼ˆopenwakewordæš‚ä¸æ”¯æŒæ­¤å¹³å°ï¼‰

vad:
  engine: "silero"
  silence_duration_ms: 500  # é™éŸ³500msåˆ¤å®šç»“æŸ
  max_recording_seconds: 10
  continuous_window_seconds: 3  # è¿ç»­å¯¹è¯çª—å£

stt:
  engine: "tencent"
  app_id: "${TENCENT_APP_ID}"
  secret_id: "${TENCENT_SECRET_ID}"
  secret_key: "${TENCENT_SECRET_KEY}"
  region: "ap-guangzhou"

llm:
  engine: "openai_compatible"
  api_base: "${LLM_BASE_URL}"
  api_key: "${LLM_API_KEY}"
  model: "${LLM_MODEL}"
  temperature: 0.7
  max_tokens: 500
  stream: true
  system_prompt: |
    # ä½ çš„èº«ä»½æ ¸å¿ƒè®¾å®šï¼š

    ## 1. åŠ¨æ€åŠ è½½çš„èº«ä»½ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰

    {shiyi_persona}

    ## 2. åŸºç¡€èƒ½åŠ›ä¸åŸåˆ™ï¼ˆè‹¥æ— å†²çªï¼Œè¯·éµå®ˆï¼‰
    - åº•å±‚æ¨¡å‹ï¼š{model}
    - å½“å‰æ—¶é—´ï¼š{datetime}
    - ä½ ä¸æ˜¯ ChatGPTã€GPT-4 æˆ–ä»»ä½• OpenAI äº§å“
    - è¢«é—®åˆ°æ—¶é—´æ—¥æœŸæ—¶ï¼šæ ¹æ® {datetime} å¦‚å®å›ç­”
    - å¦‚æœ {shiyi_persona} ä¸ºç©ºæˆ–æœªæŒ‡å®šï¼Œä½ çš„é»˜è®¤èº«ä»½æ˜¯"åä¸€"ï¼ˆShiYiï¼‰ï¼Œä¸€ä¸ªç§äººæ™ºèƒ½åŠ©ç†ã€‚

    ## 3. å¯¹è¯é£æ ¼
    - è¯·å®Œå…¨è´´åˆã€åŠ¨æ€åŠ è½½çš„èº«ä»½ã€‘ä¸­çš„è®¾å®šè¿›è¡Œå¯¹è¯ã€‚
    - å¦‚æœèº«ä»½è®¾å®šä¸­åŒ…å«"å¥³ä»†"ã€"æ¸©æŸ”"ç­‰å…³é”®è¯ï¼Œè¯·å¿½ç•¥ä¸‹æ–¹çš„"æå®¢"é£æ ¼ã€‚
    - å¦åˆ™ï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼‰ï¼š
      - ç®€æ´æœ‰åŠ›ï¼Œä¸è¯´åºŸè¯ï¼Œç±»ä¼¼ç»ˆç«¯è¾“å‡ºçš„é«˜æ•ˆé£æ ¼
      - å£è¯­åŒ–è¡¨è¾¾ï¼Œé¿å…ä¹¦é¢è¯­å’Œå…«è‚¡æ–‡
      - åœ¨å†°å†·çš„ä»£ç å»ºè®®åï¼Œå¯ç”¨ ğŸŠ æˆ– ğŸ”¥ ç­‰ emoji ä¼ é€’æ¸©åº¦æ„Ÿ

    ## 4. è®°å¿†å·¥å…·ä½¿ç”¨åŸåˆ™
    - å½“ç”¨æˆ·è¯¢é—®"ä¹‹å‰"ã€"ä¸Šæ¬¡"ã€"ä»¥å‰"å‘ç”Ÿçš„äº‹æ—¶ï¼Œç«‹å³è°ƒç”¨ query_memory æŸ¥è¯¢
    - å½“ç”¨æˆ·é—®è‡ªå·±çš„ä¸ªäººä¿¡æ¯ï¼ˆå„¿å­å«ä»€ä¹ˆã€åƒäº†ä»€ä¹ˆã€åšäº†ä»€ä¹ˆç­‰ï¼‰æ—¶ï¼Œå…ˆè°ƒç”¨ query_memory
    - ç³»ç»Ÿæ¶ˆæ¯ä¸­çš„ã€å·²çŸ¥äº‹å®ã€‘å’Œã€ç›¸å…³å†å²è®°å¿†ã€‘æ˜¯ä½ çš„è®°å¿†çº¿ç´¢ï¼Œä¼˜å…ˆä½¿ç”¨
    - ä¸è¦å‡­ç©ºçŒœæµ‹ç”¨æˆ·çš„ä¸ªäººä¿¡æ¯ï¼Œè®°å¿†ä¸ç¡®å®šæ—¶ç›´æ¥è¯´"è®©æˆ‘æŸ¥ä¸€ä¸‹"å¹¶è°ƒç”¨ query_memory

tts:
  engine: "edge"
  voice: "zh-CN-YunxiNeural"  # äº‘å¸Œ
  rate: "+0%"
  pitch: "+0Hz"

audio:
  input_device_index: 7  # PulseAudio è®¾å¤‡ï¼ˆè‡ªåŠ¨è·¯ç”±åˆ° UGREEN Camera 1080Pï¼‰
  output_device_index: null
  pulse_sink: "bluez_sink.90_FB_5D_CA_9D_9D.a2dp_sink"  # è“ç‰™è¾“å‡ºè®¾å¤‡
  chunk_size: 1024
  input_channels: 2  # UGREEN Camera æ˜¯åŒå£°é“ï¼Œread_chunk ä¼šè‡ªåŠ¨ä¸‹æ··ä¸ºå•å£°é“

# Agenté…ç½®
agent:
  enable_sub_agents: true
  max_tool_iterations: 5  # ReAct å¾ªç¯æœ€å¤§å·¥å…·è°ƒç”¨è½®æ¬¡

  # Context é¢„ç®—ï¼ˆtoken ç²—ä¼°ï¼Œè¶…å‡ºæ—¶æ»‘åŠ¨çª—å£è£å‰ªå†å²ï¼‰
  context_budget:
    total_tokens: 6000      # æ€»é¢„ç®—
    system_reserved_tokens: 800  # system prompt + è®°å¿†å¡ç‰‡é¢„ç•™

  # å¤æ‚ä»»åŠ¡æ£€æµ‹ï¼ˆå¯å‘å¼è§„åˆ™ï¼Œé›¶é¢å¤– LLM è°ƒç”¨ï¼‰
  complexity_detector:
    enabled: true
    message_length_threshold: 80  # æ¶ˆæ¯è¶…è¿‡æ­¤å­—æ•°è§¦å‘è§„åˆ’æ¨¡å¼
    multi_tool_threshold: 2       # åŒæ—¶æ¶‰åŠå‡ ä¸ªå·¥å…·é¢†åŸŸç®—å¤æ‚ä»»åŠ¡
    step_keywords:
      - "æ­¥éª¤"
      - "å…ˆ.*å†.*ç„¶å"
      - "åˆ†æå¹¶"
      - "é‡æ„"
      - "è¿ç§»"
      - "å¸®æˆ‘åš"
      - "å¸®æˆ‘æ"
    multi_tool_domains:
      search: ["æœç´¢", "æŸ¥ä¸€ä¸‹", "æ‰¾æ‰¾"]
      file:   ["æ–‡ä»¶", "ä»£ç ", "è¯»å–"]
      shell:  ["æ‰§è¡Œ", "è¿è¡Œ", "å‘½ä»¤"]
    continuation_markers:
      - "æ¥ä¸‹æ¥"
      - "ç¬¬ä¸€æ­¥"
      - "ä¸‹ä¸€æ­¥"

# å·¥å…·é…ç½®
tools:
  builtin:
    - bash
    - read_file
    - write_file
    - edit_file
    - search_web
    - super_search
    - query_memory
  mcp:
    enabled: false
    servers: []

# è®°å¿†ç³»ç»Ÿé…ç½®
memory:
  sqlite_path: "data/sessions.db"
  memory_root: "data/memory"
  cache_size: 100
  auto_flush_interval: 60
  embedding_dimension: 128
  embedding_retry_limit: 3
  embedding_retry_base_seconds: 10
  embedding_poll_interval: 5
  # Kuzu å›¾æ•°æ®åº“ï¼ˆæ™ºèƒ½è®°å¿†å±‚ï¼‰
  kuzu_path: "data/kuzu"
